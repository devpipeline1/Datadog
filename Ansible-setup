Install below packages
sudo yum install python3 python3-pip -y
sudo yum install ansible -y

Verify 

which ansible-galaxy
ansible-galaxy --version


Create a ansible user on server

 in Ansible, the server needs to push its key to the client so it can connect and run playbooks remotely

sudo useradd -m -s /bin/bash ansible
sudo passwd ansible

switch to ansible user
su - ansible

create rsa key-pair
ssh-keygen -t rsa -b 4096 -f ~/.ssh/id_ansible

Client end setup
===============

create a ansible user

sudo useradd -m -s /bin/bash ansible
sudo passwd ansible

go to home directory and create .ssh directory 
su - ansible
mkdir -p /home/ansible/.ssh
chmod 755 /home/ansible/.ssh
create authorized_keys inside .ssh directory 
touch /home/ansible/.ssh/authorized_keys
chmod 644 /home/ansible/.ssh/authorized_keys

copy the public key to from server to client (run below command from server, please update your client ip in below command)
ssh-copy-id -i ~/.ssh/id_ansible.pub ansible@<client-ip>
if the above command not wokring, then
copy /home/ansible/.ssh/id_ansible.pub from server and paste it on client end file /home/ansible/.ssh/authorized_keys

for password less login (run this on client)
echo 'ansible ALL=(ALL) NOPASSWD:ALL' | sudo tee /etc/sudoers.d/ansible
sudo chmod 440 /etc/sudoers.d/ansible

Make sure below 2 options should be uncommented on sshd_config file

sudo vi /etc/ssh/sshd_config
PubkeyAuthentication yes
AuthorizedKeysFile      .ssh/authorized_keys


Run below commands on server 
Collections are packaged bundles of roles, modules, plugins, and documentation that extend Ansibleâ€™s core functionality.
su - ansible
create requirement.yaml
collections:
  - name: datadog.dd
  - name: ansible.windows
  - name: community.general    # only needed for openSUSE/SLES

ansible-galaxy collection install -r requirements.yml


Create inventory.ini

[linux]
linux1 ansible_host=10.0.0.10 ansible_user=ubuntu ansible_become=yes

[windows]
win1  ansible_host=10.0.0.20
      ansible_user=Administrator
      ansible_password='YourP@ssw0rd'
      ansible_connection=winrm
      ansible_winrm_scheme=https
      ansible_winrm_transport=ntlm
      ansible_winrm_server_cert_validation=ignore

write playbook
=============
---
- name: Install Datadog Agent on Linux hosts
  hosts: linux
  become: yes
  gather_facts: yes

  roles:
    - role: datadog.dd.agent
      vars:
        datadog_api_key: "{{ datadog_api_key }}"
        datadog_site: datadoghq.com
        datadog_tags:
          - env:production
          - team:backend
        datadog_logs_enabled: true
        datadog_apm_enabled: true
        datadog_process_agent_enabled: true

- name: Install Datadog Agent on Windows hosts
  hosts: windows
  become:yes
  gather_facts: no   # WinRM fact gathering can be slow

  roles:
    - role: datadog.dd.agent
      vars:
        datadog_api_key: "{{ datadog_api_key }}"
        datadog_site: datadoghq.com
        datadog_tags:
          - env:production
          - team:backend
        datadog_logs_enabled: true
        datadog_apm_enabled: true
        datadog_process_agent_enabled: true


execute playbook

ansible-playbook \
  -i inventory.ini \
  datadog-agent.yml \
  -e datadog_api_key=YOUR_DD_API_KEY
